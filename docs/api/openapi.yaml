openapi: 3.1.0
info:
  title: BabyAI API
  version: 0.1.0
  description: >
    BabyAI MVP API. 육아 기록, AI 조회, 리포트, 구독/사진 공유, Siri/Bixby 연동을 포함한다.
servers:
  - url: http://localhost:8000
    description: local
tags:
  - name: health
  - name: dev
  - name: onboarding
  - name: events
  - name: ai
  - name: reports
  - name: photos
  - name: subscription
  - name: settings
  - name: babies
  - name: assistants
paths:
  /health:
    get:
      tags: [health]
      summary: Health check
      operationId: healthcheck
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                required: [status, service]
                properties:
                  status: { type: string, example: ok }
                  service: { type: string, example: babyai-api }

  /dev/local-token:
    post:
      tags: [dev]
      summary: Issue local development JWT token (local env only)
      operationId: issueLocalDevToken
      parameters:
        - in: query
          name: sub
          required: false
          schema: { type: string, format: uuid }
        - in: query
          name: name
          required: false
          schema: { type: string }
        - in: query
          name: provider
          required: false
          schema:
            type: string
            enum: [google, apple, phone]
      responses:
        '200':
          description: Local dev token issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocalDevTokenResponse'
        '404':
          description: Not available outside local environment
        '400':
          description: Invalid input

  /api/v1/onboarding/parent:
    post:
      tags: [onboarding]
      summary: Parent onboarding with required baby profile
      operationId: onboardingParent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParentOnboardingRequest'
      responses:
        '200':
          description: Parent onboarding completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: created }
                  household_id: { type: string }
                  baby_profile_created: { type: boolean, example: true }
                  provider: { $ref: '#/components/schemas/AuthProvider' }

  /api/v1/events/voice:
    post:
      tags: [events]
      summary: Parse voice recording into structured events
      operationId: parseVoiceEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoiceUploadRequest'
      responses:
        '200':
          description: Voice parsed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceParseResponse'

  /api/v1/events/confirm:
    post:
      tags: [events]
      summary: Confirm parsed events with one-tap action
      operationId: confirmEvents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmEventsRequest'
      responses:
        '200':
          description: Confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: CONFIRMED }
                  clip_id: { type: string }
                  saved_event_count: { type: integer }

  /api/v1/events/manual:
    post:
      tags: [events]
      summary: Create a completed manual event in one request
      operationId: createManualEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualEventCreateRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: CREATED }
                  event_id: { type: string }
                  type: { type: string }

  /api/v1/events/start:
    post:
      tags: [events]
      summary: Start an in-progress event (OPEN state)
      operationId: startManualEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualEventStartRequest'
      responses:
        '200':
          description: Started
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: STARTED }
                  event_id: { type: string }
                  type: { type: string }
                  start_time: { type: string, format: date-time }
                  event_state: { type: string, example: OPEN }

  /api/v1/events/{event_id}/complete:
    patch:
      tags: [events]
      summary: Complete an OPEN event
      operationId: completeManualEvent
      parameters:
        - in: path
          name: event_id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualEventCompleteRequest'
      responses:
        '200':
          description: Completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: COMPLETED }
                  event_id: { type: string }
                  type: { type: string }
                  start_time: { type: string, format: date-time }
                  end_time: { type: string, format: date-time }
                  duration_min: { type: integer }
                  event_state: { type: string, example: CLOSED }

  /api/v1/events/{event_id}/cancel:
    patch:
      tags: [events]
      summary: Cancel an OPEN event
      operationId: cancelManualEvent
      parameters:
        - in: path
          name: event_id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualEventCancelRequest'
      responses:
        '200':
          description: Canceled
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: CANCELED }
                  event_id: { type: string }
                  type: { type: string }
                  event_state: { type: string, example: CANCELED }

  /api/v1/events/open:
    get:
      tags: [events]
      summary: List OPEN events for a baby
      operationId: listOpenEvents
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: type
          required: false
          schema:
            type: string
            enum: [FORMULA, BREASTFEED, SLEEP, PEE, POO, GROWTH, MEMO, SYMPTOM, MEDICATION]
      responses:
        '200':
          description: Open events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpenEventsResponse'

  /api/v1/settings/me:
    get:
      tags: [settings]
      summary: Get current app settings for authenticated user
      operationId: getMySettings
      responses:
        '200':
          description: User settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSettingsResponse'
    patch:
      tags: [settings]
      summary: Update current app settings for authenticated user
      operationId: updateMySettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSettingsUpdateRequest'
      responses:
        '200':
          description: Updated user settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSettingsResponse'

  /api/v1/data/export.csv:
    get:
      tags: [settings]
      summary: Export baby event data as CSV
      operationId: exportBabyDataCsv
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: CSV data export
          content:
            text/csv:
              schema:
                type: string
                format: binary

  /api/v1/babies/profile:
    get:
      tags: [babies]
      summary: Get baby profile and feeding recommendation
      operationId: getBabyProfile
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Baby profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BabyProfileResponse'
    patch:
      tags: [babies]
      summary: Upsert baby profile settings
      operationId: upsertBabyProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BabyProfileUpdateRequest'
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BabyProfileResponse'

  /api/v1/ai/query:
    post:
      tags: [ai]
      summary: Ask chatbot with optional personal-data mode
      operationId: aiQuery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AiQueryRequest'
      responses:
        '200':
          description: AI response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AiQueryResponse'

  /api/v1/quick/last-feeding:
    get:
      tags: [ai]
      summary: Get latest feeding snapshot
      operationId: quickLastFeeding
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
        - in: query
          name: tz_offset
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Latest feeding snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuickSnapshotResponse'

  /api/v1/quick/recent-sleep:
    get:
      tags: [ai]
      summary: Get latest sleep snapshot
      operationId: quickRecentSleep
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
        - in: query
          name: tz_offset
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Latest sleep snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuickSnapshotResponse'

  /api/v1/quick/last-diaper:
    get:
      tags: [ai]
      summary: Get latest diaper snapshot
      operationId: quickLastDiaper
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
        - in: query
          name: tz_offset
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Latest diaper snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuickSnapshotResponse'

  /api/v1/quick/last-medication:
    get:
      tags: [ai]
      summary: Get latest medication snapshot
      operationId: quickLastMedication
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
        - in: query
          name: tz_offset
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Latest medication snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuickSnapshotResponse'

  /api/v1/quick/last-poo-time:
    get:
      tags: [ai]
      summary: Get the last poo event time
      operationId: quickLastPooTime
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
      responses:
        '200':
          description: Last poo time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LastPooTimeResponse'

  /api/v1/quick/next-feeding-eta:
    get:
      tags: [ai]
      summary: Get next feeding ETA from recent feeding intervals
      operationId: quickNextFeedingEta
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: tone
          schema: { $ref: '#/components/schemas/AiTone' }
      responses:
        '200':
          description: Next feeding ETA
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NextFeedingEtaResponse'

  /api/v1/quick/today-summary:
    get:
      tags: [ai]
      summary: Get today's summary lines
      operationId: quickTodaySummary
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Today summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodaySummaryResponse'

  /api/v1/quick/landing-snapshot:
    get:
      tags: [ai]
      summary: Get landing dashboard snapshot for day/week/month records
      operationId: quickLandingSnapshot
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: range
          required: false
          schema:
            type: string
            enum: [day, week, month]
        - in: query
          name: tz_offset
          required: false
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Landing dashboard snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LandingSnapshotResponse'

  /api/v1/reports/daily:
    get:
      tags: [reports]
      summary: Daily report
      operationId: getDailyReport
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: date
          required: true
          schema: { type: string, format: date }
        - in: query
          name: tz_offset
          required: false
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Daily report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailyReportResponse'

  /api/v1/reports/weekly:
    get:
      tags: [reports]
      summary: Weekly report
      operationId: getWeeklyReport
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: week_start
          required: true
          schema: { type: string, format: date }
        - in: query
          name: tz_offset
          required: false
          schema: { type: string, example: '+09:00' }
      responses:
        '200':
          description: Weekly report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyReportResponse'

  /api/v1/photos/upload-url:
    post:
      tags: [photos]
      summary: Create presigned upload URL
      operationId: createPhotoUploadUrl
      parameters:
        - in: query
          name: album_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Presigned URL created
          content:
            application/json:
              schema:
                type: object
                properties:
                  album_id: { type: string }
                  upload_url: { type: string, format: uri }
                  object_key: { type: string }

  /api/v1/photos/complete:
    post:
      tags: [photos]
      summary: Confirm photo upload and generate variants metadata
      operationId: completePhotoUpload
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhotoUploadCompleteRequest'
      responses:
        '200':
          description: Upload completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: uploaded }
                  photo_id: { type: string }
                  album_id: { type: string }
                  downloadable: { type: boolean }
                  variants:
                    type: object
                    additionalProperties: { type: string }

  /api/v1/photos/upload:
    post:
      tags: [photos]
      summary: Upload photo file directly from mobile app
      operationId: uploadPhotoFromDevice
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PhotoDeviceUploadRequest'
      responses:
        '200':
          description: Photo uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhotoDeviceUploadResponse'

  /api/v1/photos/recent:
    get:
      tags: [photos]
      summary: List recently uploaded photos for a baby
      operationId: listRecentPhotos
      parameters:
        - in: query
          name: baby_id
          required: true
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200, default: 48 }
      responses:
        '200':
          description: Recent photos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecentPhotosResponse'

  /api/v1/subscription/me:
    get:
      tags: [subscription]
      summary: Get household subscription
      operationId: getMySubscription
      parameters:
        - in: query
          name: household_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Subscription snapshot
          content:
            application/json:
              schema:
                type: object
                properties:
                  household_id: { type: string }
                  plan: { $ref: '#/components/schemas/SubscriptionPlan' }
                  status: { type: string, example: active }

  /api/v1/subscription/checkout:
    post:
      tags: [subscription]
      summary: Start checkout
      operationId: checkoutSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
      responses:
        '200':
          description: Checkout started
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: pending_payment }
                  plan: { $ref: '#/components/schemas/SubscriptionPlan' }
                  household_id: { type: string }
                  care_meta_enriched_baby: { type: integer, format: int32, example: 1 }

  /api/v1/assistants/siri/{intentName}:
    post:
      tags: [assistants]
      summary: Siri App Intent dialog endpoint
      operationId: executeSiriIntent
      parameters:
        - in: path
          name: intentName
          required: true
          schema:
            type: string
            enum: [GetLastPooTime, GetNextFeedingEta, GetTodaySummary]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SiriIntentRequest'
      responses:
        '200':
          description: Dialog response for Siri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssistantDialogResponse'

  /api/v1/assistants/bixby/query:
    post:
      tags: [assistants]
      summary: Bixby endpoint query
      operationId: executeBixbyQuery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BixbyQueryRequest'
      responses:
        '200':
          description: Bixby answer payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  answer: { type: string }
                  resultMoment: { type: boolean, example: true }

components:
  schemas:
    AuthProvider:
      type: string
      enum: [apple, google, phone]

    AiTone:
      type: string
      enum: [friendly, neutral, formal, brief, coach]

    SubscriptionPlan:
      type: string
      enum: [AI_ONLY, AI_PHOTO]

    ThemeMode:
      type: string
      enum: [system, dark, light]

    ParentOnboardingRequest:
      type: object
      required: [provider, baby_name, baby_birth_date, required_consents]
      properties:
        provider: { $ref: '#/components/schemas/AuthProvider' }
        baby_name: { type: string }
        baby_birth_date: { type: string, format: date }
        baby_sex:
          type: string
          enum: [male, female, other, unknown]
        baby_weight_kg: { type: number, format: float }
        feeding_method:
          type: string
          enum: [formula, breastmilk, mixed]
        formula_brand: { type: string }
        formula_product: { type: string }
        formula_type: { type: string, example: standard }
        formula_contains_starch: { type: boolean }
        required_consents:
          type: array
          items:
            type: string
            enum: [terms, privacy, data_processing]

    VoiceUploadRequest:
      type: object
      required: [baby_id]
      properties:
        baby_id: { type: string }
        transcript_hint: { type: string }

    EventItem:
      type: object
      required: [type, start_time, value]
      properties:
        type:
          type: string
          enum: [FORMULA, BREASTFEED, SLEEP, PEE, POO, GROWTH, MEMO, SYMPTOM, MEDICATION]
        start_time: { type: string, format: date-time }
        end_time: { type: string, format: date-time, nullable: true }
        value:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true
        confidence:
          type: object
          additionalProperties:
            type: number
            format: float

    VoiceParseResponse:
      type: object
      required: [clip_id, transcript, parsed_events, status]
      properties:
        clip_id: { type: string }
        transcript: { type: string }
        parsed_events:
          type: array
          items: { $ref: '#/components/schemas/EventItem' }
        status:
          type: string
          enum: [PARSED, FAILED]

    ConfirmEventsRequest:
      type: object
      required: [clip_id, events]
      properties:
        clip_id: { type: string }
        events:
          type: array
          items: { $ref: '#/components/schemas/EventItem' }

    ManualEventCreateRequest:
      type: object
      required: [baby_id, type, start_time]
      properties:
        baby_id: { type: string }
        type:
          type: string
          enum: [FORMULA, BREASTFEED, SLEEP, PEE, POO, GROWTH, MEMO, SYMPTOM, MEDICATION]
        start_time: { type: string, format: date-time }
        end_time: { type: string, format: date-time, nullable: true }
        value:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true

    ManualEventStartRequest:
      type: object
      required: [baby_id, type, start_time]
      properties:
        baby_id: { type: string }
        type:
          type: string
          enum: [FORMULA, BREASTFEED, SLEEP, PEE, POO, MEDICATION, MEMO]
        start_time: { type: string, format: date-time }
        value:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true

    ManualEventCompleteRequest:
      type: object
      properties:
        end_time: { type: string, format: date-time, nullable: true }
        value:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true

    ManualEventCancelRequest:
      type: object
      properties:
        reason: { type: string }

    OpenEventItem:
      type: object
      properties:
        event_id: { type: string }
        type: { type: string }
        status: { type: string, example: OPEN }
        start_time: { type: string, format: date-time }
        value:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true
        created_at: { type: string, format: date-time }
        can_complete: { type: boolean }
        can_cancel: { type: boolean }

    OpenEventsResponse:
      type: object
      properties:
        baby_id: { type: string }
        open_events:
          type: array
          items: { $ref: '#/components/schemas/OpenEventItem' }
        open_count: { type: integer }
        event_state: { type: string, example: OPEN }
        reference_text: { type: string }

    AiQueryRequest:
      type: object
      required: [baby_id, question]
      properties:
        baby_id: { type: string }
        question: { type: string }
        tone: { $ref: '#/components/schemas/AiTone' }
        use_personal_data: { type: boolean, default: true }
        date_mode:
          type: string
          description: Explicit chat data scope mode.
          enum: [day, week, month]
          default: day
        anchor_date:
          type: string
          format: date
          description: Anchor date for date_mode (YYYY-MM-DD).
        tz_offset:
          type: string
          description: Local timezone offset in +/-HH:MM (e.g. +09:00).

    AiQueryResponse:
      type: object
      properties:
        answer: { type: string }
        labels:
          type: array
          items: { type: string }
        tone: { $ref: '#/components/schemas/AiTone' }
        use_personal_data: { type: boolean }

    QuickSnapshotResponse:
      type: object
      properties:
        timestamp: { type: string, format: date-time, nullable: true }
        local_time: { type: string, format: date-time, nullable: true }
        amount_ml: { type: number, nullable: true }
        duration_min: { type: number, nullable: true }
        type: { type: string, nullable: true }
        confidence: { type: number, nullable: true }
        reference_text: { type: string }
        message: { type: string }

    LastPooTimeResponse:
      type: object
      properties:
        last_poo_time: { type: string, format: date-time, nullable: true }
        reference_text: { type: string }
        message: { type: string }

    NextFeedingEtaResponse:
      type: object
      properties:
        eta_minutes: { type: integer, nullable: true }
        reference_text: { type: string }
        message: { type: string }
        unstable: { type: boolean }

    TodaySummaryResponse:
      type: object
      properties:
        summary_lines:
          type: array
          items: { type: string }
        reference_text: { type: string }

    LandingSnapshotResponse:
      type: object
      properties:
        date: { type: string, format: date }
        range: { type: string, enum: [day, week, month] }
        range_label: { type: string }
        range_start_date: { type: string, format: date }
        range_end_date: { type: string, format: date }
        range_day_count: { type: integer }
        tz_offset: { type: string }
        formula_count: { type: integer }
        formula_times:
          type: array
          items: { type: string, format: date-time }
        formula_total_ml: { type: integer }
        avg_formula_ml_per_day: { type: number, format: float }
        avg_feedings_per_day: { type: number, format: float }
        formula_amount_by_time_band_ml:
          type: object
          properties:
            night: { type: integer }
            morning: { type: integer }
            afternoon: { type: integer }
            evening: { type: integer }
        last_formula_time: { type: string, format: date-time, nullable: true }
        breastfeed_count: { type: integer }
        breastfeed_times:
          type: array
          items: { type: string, format: date-time }
        last_breastfeed_time: { type: string, format: date-time, nullable: true }
        recent_sleep_time: { type: string, format: date-time, nullable: true }
        recent_sleep_duration_min: { type: integer, nullable: true }
        sleep_total_min: { type: integer }
        sleep_day_total_min: { type: integer }
        sleep_night_total_min: { type: integer }
        avg_sleep_minutes_per_day: { type: number, format: float }
        avg_nap_minutes_per_day: { type: number, format: float }
        avg_night_sleep_minutes_per_day: { type: number, format: float }
        last_sleep_end_time: { type: string, format: date-time, nullable: true }
        minutes_since_last_sleep: { type: integer, nullable: true }
        diaper_pee_count: { type: integer }
        diaper_poo_count: { type: integer }
        avg_diaper_pee_per_day: { type: number, format: float }
        avg_diaper_poo_per_day: { type: number, format: float }
        last_diaper_time: { type: string, format: date-time, nullable: true }
        last_pee_time: { type: string, format: date-time, nullable: true }
        last_poo_time: { type: string, format: date-time, nullable: true }
        weaning_count: { type: integer }
        last_weaning_time: { type: string, format: date-time, nullable: true }
        medication_count: { type: integer }
        last_medication_time: { type: string, format: date-time, nullable: true }
        special_memo: { type: string }
        feeding_method: { type: string }
        formula_type: { type: string }
        formula_brand: { type: string }
        formula_product: { type: string }
        formula_contains_starch: { type: boolean, nullable: true }
        formula_display_name: { type: string }
        baby_age_days: { type: integer }
        baby_weight_kg: { type: number, format: float, nullable: true }
        recommended_formula_daily_ml: { type: integer, nullable: true }
        recommended_formula_per_feed_ml: { type: integer, nullable: true }
        recommended_feed_interval_min: { type: integer }
        recommended_next_feeding_time: { type: string, format: date-time, nullable: true }
        recommended_next_feeding_in_min: { type: integer, nullable: true }
        recommendation_note: { type: string }
        recommendation_reference_text: { type: string }
        feeding_graph_mode: { type: string }
        feeding_graph_labels:
          type: array
          items: { type: string }
        feeding_graph_points:
          type: array
          items: { type: number, format: float }
        open_formula_event_id: { type: string, nullable: true }
        open_formula_start_time: { type: string, format: date-time, nullable: true }
        open_formula_value:
          type: object
          additionalProperties: true
          nullable: true
        open_formula_memo: { type: string, nullable: true }
        open_breastfeed_event_id: { type: string, nullable: true }
        open_breastfeed_start_time: { type: string, format: date-time, nullable: true }
        open_breastfeed_value:
          type: object
          additionalProperties: true
          nullable: true
        open_breastfeed_memo: { type: string, nullable: true }
        open_sleep_event_id: { type: string, nullable: true }
        open_sleep_start_time: { type: string, format: date-time, nullable: true }
        open_sleep_value:
          type: object
          additionalProperties: true
          nullable: true
        open_sleep_memo: { type: string, nullable: true }
        open_diaper_event_id: { type: string, nullable: true }
        open_diaper_start_time: { type: string, format: date-time, nullable: true }
        open_diaper_type: { type: string, nullable: true, enum: [PEE, POO] }
        open_diaper_value:
          type: object
          additionalProperties: true
          nullable: true
        open_diaper_memo: { type: string, nullable: true }
        open_weaning_event_id: { type: string, nullable: true }
        open_weaning_start_time: { type: string, format: date-time, nullable: true }
        open_weaning_value:
          type: object
          additionalProperties: true
          nullable: true
        open_weaning_memo: { type: string, nullable: true }
        open_medication_event_id: { type: string, nullable: true }
        open_medication_start_time: { type: string, format: date-time, nullable: true }
        open_medication_value:
          type: object
          additionalProperties: true
          nullable: true
        open_medication_memo: { type: string, nullable: true }
        reference_text: { type: string }

    BabyProfileUpdateRequest:
      type: object
      required: [baby_id]
      properties:
        baby_id: { type: string }
        baby_name: { type: string }
        baby_birth_date: { type: string, format: date }
        baby_sex:
          type: string
          enum: [male, female, other, unknown]
        baby_weight_kg: { type: number, format: float }
        feeding_method:
          type: string
          enum: [formula, breastmilk, mixed]
        formula_brand: { type: string }
        formula_product: { type: string }
        formula_type: { type: string }
        formula_contains_starch: { type: boolean }

    BabyProfileResponse:
      type: object
      properties:
        baby_id: { type: string }
        baby_name: { type: string }
        birth_date: { type: string, format: date }
        age_days: { type: integer }
        sex: { type: string }
        weight_kg: { type: number, format: float, nullable: true }
        feeding_method: { type: string }
        formula_brand: { type: string }
        formula_product: { type: string }
        formula_type: { type: string }
        formula_contains_starch: { type: boolean, nullable: true }
        formula_display_name: { type: string }
        recommended_formula_daily_ml: { type: integer, nullable: true }
        recommended_formula_per_feed_ml: { type: integer, nullable: true }
        recommended_feed_interval_min: { type: integer }
        recommended_next_feeding_time: { type: string, format: date-time, nullable: true }
        recommended_next_feeding_in_min: { type: integer, nullable: true }
        recommendation_reference_text: { type: string }
        recommendation_note: { type: string }
        formula_catalog:
          type: array
          items:
            type: object
            additionalProperties: true

    DailyReportResponse:
      type: object
      properties:
        baby_id: { type: string }
        date: { type: string, format: date }
        summary:
          type: array
          items: { type: string }
        events:
          type: array
          items:
            $ref: '#/components/schemas/EventItem'
        labels:
          type: array
          items: { type: string }

    WeeklyReportResponse:
      type: object
      properties:
        baby_id: { type: string }
        week_start: { type: string, format: date }
        trend:
          type: object
          additionalProperties: { type: string }
        suggestions:
          type: array
          items: { type: string }
        labels:
          type: array
          items: { type: string }

    UserSettingsResponse:
      type: object
      properties:
        theme_mode: { $ref: '#/components/schemas/ThemeMode' }
        language: { type: string, enum: [ko, en, es] }
        main_font: { type: string, enum: [notoSans, systemSans] }
        highlight_font: { type: string, enum: [ibmPlexSans, notoSans] }
        accent_tone: { type: string, enum: [gold, teal, coral, indigo] }
        report_color_tone: { type: string, enum: [classic, ocean, sage, sunset] }
        bottom_menu_enabled:
          type: object
          additionalProperties: { type: boolean }
        child_care_profile:
          type: string
          enum: [breastfeeding, formula, weaning]
        home_tiles:
          type: object
          additionalProperties: { type: boolean }
        home_tile_columns:
          type: integer
          enum: [1, 2, 3]
        home_tile_order:
          type: array
          items:
            type: string
            enum: [formula, breastfeed, weaning, diaper, sleep, medication, memo]
        show_special_memo: { type: boolean }

    UserSettingsUpdateRequest:
      type: object
      properties:
        theme_mode: { $ref: '#/components/schemas/ThemeMode' }
        language: { type: string, enum: [ko, en, es] }
        main_font: { type: string, enum: [notoSans, systemSans] }
        highlight_font: { type: string, enum: [ibmPlexSans, notoSans] }
        accent_tone: { type: string, enum: [gold, teal, coral, indigo] }
        report_color_tone: { type: string, enum: [classic, ocean, sage, sunset] }
        bottom_menu_enabled:
          type: object
          additionalProperties: { type: boolean }
        child_care_profile:
          type: string
          enum: [breastfeeding, formula, weaning]
        home_tiles:
          type: object
          additionalProperties: { type: boolean }
        home_tile_columns:
          type: integer
          enum: [1, 2, 3]
        home_tile_order:
          type: array
          items:
            type: string
            enum: [formula, breastfeed, weaning, diaper, sleep, medication, memo]
        show_special_memo: { type: boolean }

    PhotoUploadCompleteRequest:
      type: object
      required: [album_id, object_key]
      properties:
        album_id: { type: string }
        object_key: { type: string }
        downloadable: { type: boolean, default: false }

    PhotoDeviceUploadRequest:
      type: object
      required: [file]
      properties:
        file:
          type: string
          format: binary
        album_id: { type: string }
        baby_id: { type: string }
        downloadable:
          type: string
          description: true/false or 1/0 in multipart form

    PhotoDeviceUploadResponse:
      type: object
      properties:
        status: { type: string, example: uploaded }
        photo_id: { type: string }
        album_id: { type: string }
        downloadable: { type: boolean }
        object_key: { type: string }
        photo_url: { type: string, format: uri }
        variants:
          type: object
          additionalProperties: { type: string }

    RecentPhotoItem:
      type: object
      properties:
        photo_id: { type: string }
        album_id: { type: string }
        album_title: { type: string }
        downloadable: { type: boolean }
        created_at: { type: string, format: date-time }
        preview_url: { type: string, format: uri }
        original_url: { type: string, format: uri }
        variants_json:
          type: object
          additionalProperties: true

    RecentPhotosResponse:
      type: object
      properties:
        baby_id: { type: string }
        count: { type: integer }
        reference_text: { type: string }
        photos:
          type: array
          items:
            $ref: '#/components/schemas/RecentPhotoItem'

    LocalDevTokenResponse:
      type: object
      properties:
        token: { type: string }
        sub: { type: string, format: uuid }
        name: { type: string }
        provider:
          type: string
          enum: [google, apple, phone]
        reference_text: { type: string }

    CheckoutRequest:
      type: object
      required: [household_id, plan]
      properties:
        household_id: { type: string }
        plan: { $ref: '#/components/schemas/SubscriptionPlan' }

    SiriIntentRequest:
      type: object
      required: [baby_id]
      properties:
        baby_id: { type: string }
        tone: { $ref: '#/components/schemas/AiTone' }

    AssistantDialogResponse:
      type: object
      properties:
        dialog: { type: string }
        reference: { type: string }

    BixbyQueryRequest:
      type: object
      required: [capsule_action, baby_id]
      properties:
        capsule_action:
          type: string
          enum: [GetLastPooTime, GetNextFeedingEta, GetTodaySummary]
        baby_id: { type: string }
        tone: { $ref: '#/components/schemas/AiTone' }
