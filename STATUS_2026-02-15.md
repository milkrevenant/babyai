# BabyLog AI Status (2026-02-15)

## Scope
- Immediate fixes + full run verification requested.
- Skills applied in this cycle: `app-dev`, `backend-patterns`, `security-reviewer`, `test-agent`.

## Go Migration State
- Backend is fully Go (`apps/backend`).
- Python backend files are not present in repo (`rg --files -g "*.py"` => no results).
- Legacy Python references remain only in old historical status doc: `STATUS_2026-02-14.md`.

## Fixed
1. JWT secret hardening
- Removed insecure fallback.
- Fail-fast validation added for missing/weak/insecure secret.
- Files:
  - `apps/backend/internal/config/config.go`
  - `apps/backend/cmd/api/main.go`

2. Safer auth bootstrap default
- `AUTH_AUTOCREATE_USER` default changed to `false`.
- Files:
  - `apps/backend/internal/config/config.go`
  - `apps/backend/.env.example`
  - `apps/backend/README.md`

3. Explicit CORS policy
- Added middleware with allowlist via `CORS_ALLOW_ORIGINS`.
- File:
  - `apps/backend/internal/server/app.go`

4. `confirmEvents` validation hardening
- Rejects invalid `event.type` with `400`.
- Rejects missing `start_time` with `400`.
- Rejects empty `events` with `400`.
- File:
  - `apps/backend/internal/server/handlers.go`

## Verification (Executed)

### Build/Static Checks
- `C:\Program Files\Go\bin\go.exe test ./...`: PASS
- `C:\Program Files\Go\bin\go.exe build ./...`: PASS
- `C:\Program Files\Go\bin\go.exe vet ./...`: PASS

### Runtime/Smoke Checks
- Prisma Dev DB:
  - `npx prisma dev start babylog`: running
  - `npm run prisma:push` with Prisma Dev TCP URL: PASS (schema already in sync)
- Backend run (temporary):
  - `APP_PORT=8001`
  - `C:\Program Files\Go\bin\go.exe run ./cmd/api`
- API checks:
  - `GET /health` => `200` with `{"status":"ok","service":"babylog-api"}`
  - Protected endpoint without token => `401` (as expected)
  - CORS preflight on `/api/v1/events/confirm` with `Origin: http://localhost:5173` => `204` + `Access-Control-Allow-Origin: http://localhost:5173`
- Process cleanup completed (temporary server + Prisma dev stopped).

### Mobile (Flutter) Verification
- Flutter SDK installed (non-admin method):
  - Location: `C:\Users\milkrevenant\tools\flutter`
  - Version: `Flutter 3.41.1 / Dart 3.11.0`
- `flutter doctor -v`:
  - PASS: Flutter SDK, Windows desktop toolchain, Chrome, Visual Studio, network
  - WARN: Android SDK missing (Android Studio not installed)
- Mobile scaffold generated and synced into repo:
  - Added directories: `apps/mobile/android`, `apps/mobile/ios`, `apps/mobile/linux`, `apps/mobile/macos`, `apps/mobile/web`, `apps/mobile/windows`, `apps/mobile/test`
  - Added files: `apps/mobile/.metadata`, `apps/mobile/.gitignore`, `apps/mobile/pubspec.lock`
- App launch check:
  - In copy workspace (`C:\Users\milkrevenant\mobile_run\apps\mobile`):
    - `flutter run -d windows ...` reached:
      - `Launching lib\main.dart on Windows in debug mode...`
      - `Built build\windows\x64\runner\Debug\babylog_ai.exe`
      - `Syncing files to device Windows...`
    - Runtime process observed: `babylog_ai.exe`
  - In repo path (`C:\Users\milkrevenant\Documents\code\babylog-ai\apps\mobile`):
    - `flutter pub get`: PASS
    - `flutter build windows`: PASS
      - `Built build\windows\x64\runner\Release\babylog_ai.exe`
    - `flutter run -d windows`: PASS
      - `Built build\windows\x64\runner\Debug\babylog_ai.exe`
      - Dart VM service URL printed and app process confirmed
  - Cleanup completed (Flutter/desktop app processes stopped).

## Environment Findings
- `go` is not on PATH in this shell, but Go works via absolute path.
- Flutter PATH was missing initially; user-level `FLUTTER_ROOT` + PATH entry were added.
- Controlled Folder Access is enabled (`EnableControlledFolderAccess=1`).
- Earlier CFA blocks were observed in Defender Event ID `1123` for Flutter toolchain binaries (for example `dartvm.exe`, `dartaotruntime.exe`, `impellerc.exe`, `gen_snapshot.exe`), and after allowlisting, repo-path builds/runs succeed.

## Remaining Next Work
1. Add backend automated tests (unit + API integration).
2. Split `apps/backend/internal/server/handlers.go` into feature-focused files.
